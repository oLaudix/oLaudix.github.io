<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="qunit-1.16.0.css">
<link rel="stylesheet" href="bootstrap.min.css">
<link rel="stylesheet" href="custom.css">
<title>My Page</title>
  <!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>-->
</head>
<body>
	<div style="float: left; width: 180px;">
		<ul class="nav nav-tabs nav-stacked">
			<li><a href=".">Home</a></li>
			<li><a href="TTcalc.html">Tap Titans Calculator</a></li>
			<li><a href="stuff.html">Tap Titans usefull stuff</a></li>
			<li><a href="MCcalc.html">Mine Clicker Calculator</a></li>
			<li><a href="SMCG.html">Simulation Craft Stuff</a></li>
			<li><a href="CivCrafter.html">Civ Crafter Stuff</a></li>
			<li><a href="ShonenIdle.html">Shonen Idle Stuff</a></li>
			<li><a href="incremental.html">Testing</a></li>
		</ul>
	</div>
	<div class="wrapper" style="display: inline-block;">
	Max Mobs: <input id="mobs" type="text" value="1" style="margin-left: 10px"></input>
	<div id="testing"></div>
	<div id="testing2"></div>
	<div><canvas id="myCanvas" width="1500" height="700" style="border:1px solid #000000; cursor: none"></div>
	<div id="monster_stats">"test"</div>

	
	</canvas>
	</div>
  
  
<script type="text/javascript" src="jquery-latest.min.js"></script>
<script type="text/javascript" src="bootstrap.min.js"></script>
<script src="incremental.js"></script>



<script language="javascript">/* Write JavaScript here */
//$(window).load(function start(){
	//<canvas id="buffer" width="400" height="500">
var monster = function()
{
	this.HP = RandomIntRange(100,100)
	this.HpMax = 100
	this.cycle = 0;
	this.positionX = RandomIntRange(-100,-50);
	this.old_positionX = -50;
	this.old_positionY = this.positionY
	this.img1 = new Image();
	this.img1.src = "img/player.png";
	this.spriteW = 24;
	this.spriteH = 30;
	this.positionY = RandomIntRange(0,c.height - this.spriteH)
	this.speed = RandomIntRange(40,80)
	this.next_tick = 0;
	this.c = document.getElementById("myCanvas");
	this.ctx = this.c.getContext("2d");
}

var Cursor = function()
{
	this.X = -100
	this.sprite = new Image();
	this.sprite.src = "crosshair.png";
	this.Y = -100
	this.c = document.getElementById("myCanvas");
	this.ctx = this.c.getContext("2d");
}

var cursor = new Cursor();
	
var monsters = []
for (var x = 0; x < 2000; x++)
{
	//monsters.push(new monster)
	//monsters[x].animation();
}

function drawHpBar(mob)
{
	mob.ctx.beginPath();
	if (mob.HP > mob.HpMax/3*2)
	{
		mob.ctx.fillStyle="#00FF00";
	}
	else if (mob.HP > mob.HpMax/3)
	{
		mob.ctx.fillStyle="#FF9900";
	}
	else
	{
		mob.ctx.fillStyle="#FF0000";
	}
	mob.ctx.fillRect(mob.positionX,mob.positionY - 5,24*mob.HP/100,3);
	//ctx.fillRect(20,20,150,100);
	//mob.ctx.stroke();
}


var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");

var lastUpdate = Date.now();
var elapsed = 0;
var counter = 0;
var medium = 0;

function main()
{
	var tick_start = Date.now()
	var now = Date.now();
	elapsed = (now - this.lastUpdate);
	medium += elapsed;
	counter += 1;
	lastUpdate = now;
	calculateMonsters()
	drawFrame(monsters)
	var tick_end = Date.now()
	$("#testing2").html("render time: " + (medium/counter) + " ms")
	//alert(elapsed)
	setTimeout(function() { main() }, 1)
}

main();

function calculateMonsters()
{
	if (monsters.length < parseInt($("#mobs").val()))
	{
		monsters.push(new monster)
	}
	//if (Date.now() >= next_tick)
	{
		var tick_start = Date.now()
		for (var x = 0; x < monsters.length; x++)
		{
			monsters[x].old_positionX = monsters[x].positionX
			if (monsters[x].positionX > c.width + monsters[x].spriteW)
			{
				monsters.splice(x, 1)
				continue;
			}
			else
			{
			
				var distance = (monsters[x].speed / 1000) * elapsed;
				monsters[x].positionX += distance;
			}
			if (monsters[x].HP <= 0)
			{
				monsters.splice(x, 1)
				continue;
			}
			if (Date.now() >= monsters[x].next_tick)
			{
				monsters[x].cycle = (monsters[x].cycle + 1) % 8;
				monsters[x].next_tick = Date.now() + 100
			}
		}
	}
}

function drawFrame()
{
	$("#testing").html(monsters.length + " mobs")
	ctx.clearRect(0, 0, c.width, c.height);
	ctx.drawImage(cursor.sprite, cursor.X - 20, cursor.Y - 20)
	for (var x = 0; x < monsters.length; x++)
	{
		ctx.drawImage(	monsters[x].img1,
							monsters[x].cycle * monsters[x].spriteW, 0, monsters[x].spriteW, monsters[x].spriteH,
							monsters[x].positionX, monsters[x].positionY, monsters[x].spriteW, monsters[x].spriteH);
		monsters[x].old_positionX = monsters[x].positionX
		drawHpBar(monsters[x])
	}
}

//animation2(monsters)

function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect();
        return {
          x: evt.clientX - rect.left,
          y: evt.clientY - rect.top
        };
      }
var canvas = document.getElementById('myCanvas');
var context = canvas.getContext('2d');

canvas.addEventListener('mousedown', 
	function(evt) 
	{
        var mousePos = getMousePos(canvas, evt);
        for (var x = 0; x < monsters.length; x++)
		{
			if ( ((monsters[x].positionX <= mousePos.x) && (mousePos.x <= monsters[x].positionX + monsters[x].spriteW)) && ((monsters[x].positionY <= mousePos.y) && (mousePos.y <= monsters[x].positionY + monsters[x].spriteH)) )
			{
				monsters[x].HP -= 10;
			}
		}
     }, 
	 false);
	 
canvas.addEventListener('mousemove', 
	function(evt) 
	{
        cursor.X = getMousePos(canvas, evt).x;
		cursor.Y = getMousePos(canvas, evt).y;
		var mousePos = getMousePos(canvas, evt);
        for (var x = 0; x < monsters.length; x++)
		{
			if ( ((monsters[x].positionX <= mousePos.x) && (mousePos.x <= monsters[x].positionX + monsters[x].spriteW)) && ((monsters[x].positionY <= mousePos.y) && (mousePos.y <= monsters[x].positionY + monsters[x].spriteH)) )
			{
				$("#monster_stats").html("HP: " + (monsters[x].HP))
			}
		}
     }, 
	 false);

</script></body></html>