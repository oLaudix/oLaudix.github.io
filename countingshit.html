<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="qunit-1.16.0.css">
<link rel="stylesheet" href="bootstrap.min.css">
<link rel="stylesheet" href="bootstrap-select.min.css">
<link rel="stylesheet" href="custom.css">
<title>My Page</title>
  <!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>-->
</head>
<body>
	<div style="float: left; width: 180px;">
		<ul class="nav nav-tabs nav-stacked">
			<li><a href=".">Home</a></li>
			<li><a href="TTcalc.html">Tap Titans Calculator</a></li>
			<li><a href="stuff.html">Tap Titans usefull stuff</a></li>
			<li><a href="MCcalc.html">Mine Clicker Calculator</a></li>
			<li><a href="SMCG.html">Simulation Craft Stuff</a></li>
			<li><a href="CivCrafter.html">Civ Crafter Stuff</a></li>
			<li><a href="ShonenIdle.html">Shonen Idle Stuff</a></li>
			<li><a href="incremental.html">Testing</a></li>
		</ul>
	</div>
	<div class="wrapper" style="display: inline-block;">
		<select class="selectpicker" id="selection-test" onchange="changeFunc();" data-live-search="true">
			<option id="start">None</option>
		</select>
		<button type="button" onclick="updateLevels()" class="btn btn-primary">Generate</button><br><br>
		
		<div class="panel panel-primary" style="margin-bottom: 5px; width: 1000px;">
			<div class="panel-heading">Options</div>
			<div class="panel-body" style="display: inline-block;">
				Starter options <input type="checkbox" id="starter"><br><br>
				<div style="display: inline-block;">
					Assemblers:<br>
					Assembling machine 1 <input type="checkbox" id="as1"><br>
					Assembling machine 2 <input type="checkbox" id="as2"><br>
					Assembling machine 3 <input type="checkbox" id="as3"><br>
					Assembling machine 4 <input type="checkbox" id="as4"><br>
					Assembling machine 5 <input type="checkbox" id="as5"><br>
					Assembling machine 6 <input type="checkbox" id="as6"checked><br>
					Additional Speed <input type="text" id="asmspeed" value="1920">%<br>
					Additional Productivity <input type="text" id="asmprod" value="240">%<br>
				</div>
				<div style="display: inline-block;">
					Furnace:<br>
					Electric Furnace <input type="checkbox" id="fur1"><br>
					Electric multipurpous furnace Mk2 <input type="checkbox" id="fur2" checked><br>
					Additional Speed <input type="text" id="furspeed" value="1920">%<br>
					Additional Productivity <input type="text" id="furprod" value="240">%<br>
				</div>
				<div style="display: inline-block;">
					Chemical Plant:<br>
					Chemical Plant 1 <input type="checkbox" id="chem1"><br>
					Chemical Plant 2 <input type="checkbox" id="chem2"><br>
					Chemical Plant 3 <input type="checkbox" id="chem3"><br>
					Chemical Plant 4 <input type="checkbox" id="chem4" checked><br>
					Additional Speed <input type="text" id="chemspeed" value="1920">%<br>
					Additional Productivity <input type="text" id="chemprod" value="240">%<br>
				</div>
				<div style="display: inline-block;">
					Inserter:<br>
					Basic <input type="checkbox" id="basicinserter"><br>
					Fast <input type="checkbox" id="fastinserter"><br>
					Smart <input type="checkbox" id="smartinserter" checked><br>
				</div>
			</div>
		</div>
		
		<div id="selectedTable"></div>		
		<div id="nietest">
			<div class="panel panel-primary" style="display: inline-block; width: 1000px; margin-top: -1px">
				<div class="panel-body" id="test" style="padding-bottom: 0px"></div>
			</div>			
		</div>
	</div>
  
<script type="text/javascript" src="jquery-latest.min.js"></script>
<script type="text/javascript" src="countingshit_recipies_1.js"></script>
<script type="text/javascript" src="countingshit_recipies_2.js"></script>
<script type="text/javascript" src="countingshit_recipies_3.js"></script>
<script type="text/javascript" src="countingshit_recipies_4.js"></script>
<script type="text/javascript" src="countingshit_recipies_replication.js"></script>
<script type="text/javascript" src="countingshit_ams.js"></script>
<script type="text/javascript" src="bootstrap.min.js"></script>
<script type="text/javascript" src="bootstrap-select.js"></script>
<script src="common.js"></script>



<script language="javascript">/* Write JavaScript here */
//$(window).load(function start(){

var items = $.extend({}, items_recipies1, items_recipies2, items_recipies3, items_recipies4, items_replication);
	
function changeFunc() 
{
	//table = []
    var selectBox = document.getElementById("selection-test");
    var selectedValue = selectBox.options[selectBox.selectedIndex].value;
	//alert(selectedValue)
	if (selectBox.selectedIndex > 0)
	{
		if (!selectedList.hasOwnProperty(selectBox.options[selectBox.selectedIndex].value))
		{
			//delete raw_materials[item_id]
			selectedList[selectBox.options[selectBox.selectedIndex].value] = [selectBox.options[selectBox.selectedIndex].value, 1, false];
			table = [];
			for (var k in selectedList)
			{
				table.push(selectedList[k])
			}
		}
	}
	//table.push([selectBox.options[selectBox.selectedIndex].value, 100, false]);
	selectBox.selectedIndex = 0;
	printSelected();
    //alert(selectBox.options[selectBox.selectedIndex].value);
}
   
function populateSelect()
{
	var selectOptions = []
	for (var k in items)
	{
		if (items.hasOwnProperty(k))
		{
			selectOptions.push([items[k].name, k])
		}
	}
	selectOptions.sort();
	for (var a = 0; a < selectOptions.length; a++)
	{
		
		var x = document.getElementById("selection-test");
		var option = document.createElement("option");
		option.text = selectOptions[a][0];
		option.value = selectOptions[a][1];
		x.add(option);
	}
	//alert(selectOptions)
}
   
function make_tree(item_id, quantity, test)
{
	//$("#test").html(items[item_id].name)
	var real_prod_time = items[item_id].energy_required / ams[items[item_id].am_type].speed;
	//alert(items[item_id].name)
	//Normal Production
	var real_ticks = Math.ceil(real_prod_time*60);
	var items_per_sec = 60/real_ticks * items[item_id].result;
	var items_per_min = items_per_sec * 60;
	//Productivity bonus
	var prod_ticks = real_prod_time * 60 / (ams[items[item_id].am_type].productivity - 1)
	var prod_per_sec = Math.min(60 / prod_ticks, 60) * items[item_id].result;
	var prod_per_min = prod_per_sec * 60;
	var total_production = items_per_min + prod_per_min
	//var asms_needed = Math.ceil(quantity / (items_per_min + prod_per_min))
	var asms_needed = (quantity / (items_per_min + prod_per_min))
	var final_production = total_production * asms_needed
	var summary = "<div class=\"panel panel-primary\" style=\"display: inline-block; margin-bottom: 0px\">";
	summary += "<div class=\"panel-heading\">" + items[item_id].name + " - " + round_num(quantity) + "</div><div class=\"panel-body\" style=\"display: inline-block; margin-bottom: -10px; margin-top: -30px\"><br>";
	//summary += ams[items[item_id].am_type].speed + "<br>";
	//summary += "Assemblers needed: " + asms_needed + "<br>";
	//summary += items[item_id].name + " - Total: " + final_production + "<br>";
	//summary += items[item_id].name + " - Normal: " + items_per_min * asms_needed + "<br>";
	//summary += items[item_id].name + " - Productivity: " + prod_per_min * asms_needed + "<br>";
	if (items[item_id].ingredients.length > 0)
	{
		if (total.hasOwnProperty(item_id))
		{
			var temp = total[item_id][1] + quantity
			delete total[item_id]
			total[item_id] = [items[item_id].name, temp, asms_needed];
			//total[item_id][1] += quantity;
		}
		else
		{
			total[item_id] = [items[item_id].name, quantity, asms_needed];
		}
	}
	else
	{
		if (raw_materials.hasOwnProperty(item_id))
		{
			var temp = raw_materials[item_id][1] + quantity
			delete raw_materials[item_id]
			raw_materials[item_id] = [items[item_id].name, temp, asms_needed];
			//total[item_id][1] += quantity;
		}
		else
		{
			if (items[item_id].category != "fluid")
			{
				raw_materials[item_id] = [items[item_id].name, quantity, asms_needed];
			}
		}
	}
	if (test)
	{
		for (var a = 0; a < items[item_id].ingredients.length; a++)
		{
			if (items.hasOwnProperty(items[item_id].ingredients[a][0]))
			{
				summary += make_tree(items[item_id].ingredients[a][0], (items[item_id].ingredients[a][1] * quantity / items[item_id].result), true)
			}
			else
			{	
				summary += "" + items[item_id].ingredients[a][0] + " - " + (items[item_id].ingredients[a][1] * quantity / items[item_id].result) + " needed<br>";
				alert("Missing recipe for " + items[item_id].ingredients[a][0])
			}
		}
	}
	else
	{
		for (var a = 0; a < items[item_id].ingredients.length; a++)
		{
			//alert(items[item_id].name + "\n" + items[item_id].ingredients)
			if (items.hasOwnProperty(items[item_id].ingredients[a][0]))
			{
				summary += make_tree(items[item_id].ingredients[a][0], (items[item_id].ingredients[a][1] * (items_per_min * asms_needed / items[item_id].result)), false)
			}
			else
			{
				summary += "" + items[item_id].ingredients[a][0] + " - " + (items[item_id].ingredients[a][1] * (items_per_min * asms_needed / items[item_id].result)) + " needed<br>";
				//alert("Missing recipe for " + items[item_id].ingredients[a][0])
				if (missing.hasOwnProperty(item_id))
				{
					
				}
				else
				{
					missing.push(items[item_id].ingredients[a][0])
				}
			}
		}
	}
	
	summary += "</div></div><br><br>"	
	return summary;
}

function calc_asm(item_id, quantity)
{
	var real_prod_time = items[item_id].energy_required / ams[items[item_id].am_type].speed;
	//Normal Production
	var real_ticks = Math.ceil(real_prod_time*60);
	var items_per_sec = 60/real_ticks * items[item_id].result;
	var items_per_min = items_per_sec * 60;
	//Productivity bonus
	var prod_ticks = real_prod_time * 60 / (ams[items[item_id].am_type].productivity - 1)
	var prod_per_sec = Math.min(60 / prod_ticks, 60) * items[item_id].result;
	var prod_per_min = prod_per_sec * 60;
	var total_production = Math.min(items_per_min + prod_per_min, 28800)
	items[item_id].production = total_production;
	items[item_id].asms_needed = asms_needed;
	//var asms_needed = Math.ceil(quantity / (items_per_min + prod_per_min))
	var asms_needed = (quantity / (total_production))
	var final_production = total_production * asms_needed
	var summary = items[item_id].name + " - <font color=\"red\", style=\"font-weight: bold;\">" + Math.ceil(asms_needed) + "</font>"
	switch (ams[items[item_id].am_type].name)
	{
		case "assembling-machine-6":
			summary += "<font color=\"green\", style=\"font-weight: bold;\"> assemblers </font>needed for " 
			break;
		case "assembling-machine-5":
			summary += "<font color=\"green\", style=\"font-weight: bold;\"> assemblers </font>needed for " 
			break;
		case "assembling-machine-4":
			summary += "<font color=\"green\", style=\"font-weight: bold;\"> assemblers </font>needed for " 
			break;
		case "assembling-machine-3":
			summary += "<font color=\"green\", style=\"font-weight: bold;\"> assemblers </font>needed for " 
			break;
		case "assembling-machine-2":
			summary += "<font color=\"green\", style=\"font-weight: bold;\"> assemblers </font>needed for " 
			break;
		case "assembling-machine-1":
			summary += "<font color=\"green\", style=\"font-weight: bold;\"> assemblers </font>needed for " 
			break;		
		case "replicator-5":
			summary += "<font color=\"blue\", style=\"font-weight: bold;\"> replicators </font>needed for " 
			break;
		case "chemical-plant-4":
			summary += "<font color=\"orange\", style=\"font-weight: bold;\"> chemical plants </font>needed for " 
			break;
		case "chemical-plant":
			summary += "<font color=\"orange\", style=\"font-weight: bold;\"> chemical plants </font>needed for " 
			break;
		case "electric-chemical-mixing-furnace-2":
			summary += "<font color=\"purple\", style=\"font-weight: bold;\"> furnaces </font>needed for " 
			break;
		case "electric-furnace":
			summary += "<font color=\"purple\", style=\"font-weight: bold;\"> furnaces </font>needed for " 
			break;
		case "y-alien-infuser":
			summary += "<font color=\"purple\", style=\"font-weight: bold;\"> alien infusers </font>needed for " 
			break;
	}
	summary += round_num(quantity) + "units (" + Math.floor(total_production) + ") - " + items[item_id].energy_required + " - " + ams[items[item_id].am_type].speed 
	summary += " - " + Math.ceil((Math.floor(total_production)/60)/96) + " inserters needed<br>"
	if (items[item_id].ingredients.length > 0)
	{
		all_assembling_machines += Math.ceil(asms_needed);
	}
	else
	{
		all_replicators += Math.ceil(asms_needed);
	}
	return summary;
}

function calc_total(items_table)
{
	all_assembling_machines = 0;
	all_replicators = 0;
	total = {};
	missing = [];
	$("#test").html("")
	raw_materials = {};
	for (var a = 0; a < items_table.length; a++)
	{
		//$("#test").append(make_tree(items_table[a][0], items_table[a][1]))
		make_tree(items_table[a][0], items_table[a][1], items_table[a][2])
	}
	for (var k in total)
	{
		//$("#test").append(total[k][0] + " - " + total[k][2] + " assemblers needed for " + total[k][1] + " units<br>")
		var temp = calc_asm(k, total[k][1])
		if ($("#starter").is(":checked"))
		{
			make_starter_blueprint(k)
		}
		else
		{
			make_blueprint(k)
		}
		$("#test").append(temp)
	}
	$("#test").append("<br>")
	for (var k in raw_materials)
	{
		//$("#test").append(total[k][0] + " - " + total[k][2] + " assemblers needed for " + total[k][1] + " units<br>")
		make_replicator_blueprint(k)
		$("#test").append(calc_asm(k, raw_materials[k][1]))
	}
	$("#test").append("<br>")
	for (var a = 0; a < missing.length; a++)
	{
		//$("#test").append(total[k][0] + " - " + total[k][2] + " assemblers needed for " + total[k][1] + " units<br>")
		$("#test").append(missing[a] + "<br>")
	}
	alert(all_assembling_machines + " assembling machines(" + (all_assembling_machines/10) + ") + " + all_replicators + " replicators.(" + (all_replicators/18) + ")")
	//make_blueprint(items_table[0][0])
}

function round_num(num)
{
	return Math.round((num + 0.00001) * 100) / 100
}

function calculate_recipe(item_id)
{
	var length = 9;
	var recipe = [];
	var fluids = [];
	var keysSorted = items[item_id].ingredients.sort(function(a, b){    var x=a[1];    var y=b[1];    return y-x;});
	for (var a = 0; a < items[item_id].ingredients.length; a++)
	{
		//alert(item_id)
		try
		{
			if (items[items[item_id].ingredients[a][0]].category == "fluid")
			{
				length -= 2;
			}
		}
		catch(err) 
		{
			alert(items[item_id].ingredients[a][0])
		} 
	}
	if (items[item_id].production > 17280)
	{
		length -= 2;
	}
	//alert(length)
	var a = 0;
	var b = -1;
	while (recipe.length<length)
	{
		if (b === items[item_id].ingredients.length - 1)
		{
			b = 0;
		}
		else
		{
			b += 1;
		}
		if (items[items[item_id].ingredients[b][0]].category == "fluid")
		{
			fluids.push(items[item_id].ingredients[b][0])
		}
		else
		{
			recipe.push(items[item_id].ingredients[b][0])
		}
		a++;
		if (a>20) { break }
		//if (items[items[item_id].ingredients[b][0]].category == "fluid") { alert("fluid") }
	}
	if (recipe.length == 0)
	{
		for(var z=0; z<length; z++)
		{
			recipe.push(items['coal'].id)
		}
	}
	keysSorted = recipe.sort();
	//alert(recipe.length)
	return {
        normal: keysSorted,
        fluid: fluids
    };
}

/*
directions
2 - left
4 - up
6 - right
*/

function add_assembler(type, recipe, position, direction)
{
	entity_number += 1
	return "[" + entity_number + "]={entity_number=" + entity_number + ",name=\"" + type + "\",position={x=" + position[0] + ",y=" + position[1] + "},recipe=\"" + recipe + "\",direction=\"" + direction + "\"},"
}

function add_icon(icons)
{
	var text = "icons={";
	for (var a = 0; a < icons.length; a++)
	{
		text += "[" + a + "]={name=\"" + icons[a] + "\",index=" + (a+1) + ","
	}
	text += "}},"
	return text
}

function add_entity(type, position, direction, connection, conditions, requester)
{
	entity_number += 1
	var txt = "[" + entity_number + "]={entity_number=" + entity_number + ",name=\"" + type + "\",position={x=" + position[0] + ",y=" + position[1] + "},direction=\"" + direction + "\","
	if (connection.length > 0)
	{
		txt += "connections={[\"1\"]={red={[1]={entity_id=" + connection + "}}}},"
	}
	if (conditions.length > 0)
	{
		txt += "conditions={" + conditions[0] + "={first_signal={type=\"item\",name=\"" + conditions[1] + "\"},constant=" + conditions[2] + ",comparator=\"" + conditions[3] + "\"}}"
		// logistics, circuit
	} 
	if (requester.length > 0)
	{
	txt += "request_filters={[1]={index=1,name=\"" + requester[0] + "\",count=" + requester[1] + "}}"
	}
	txt += "},"
	return txt;
}

function add_name(name)
{
	return "name=\"" + name + "\""
}

var inserter_type = "basic-inserter"
function make_starter_blueprint(item_id)
{
	var output = 100;
	var input = 100;
	entity_number = -1;	
	var input_positions = {
	"4": { inserter: { x:-1, y:2, vector:4 }, chest: { x:-1 ,y:3  } },
	"5": { inserter: { x:0, y:2, vector:4 }, chest: { x:0 ,y:3  } },
	"6": { inserter: { x:1, y:2, vector:4 }, chest: { x:1 ,y:3  } },
	}
	var name = items[item_id].id
	var recipe = calculate_recipe(item_id)
	$("#test").append("<textarea id=\"" + item_id + "\" style=\"width: 10px; height: 10px; display: none\"></textarea><button type=\"button\" id=\"" + item_id + "blueprintButton\" onclick=\"copyBlueprint('" + item_id + "')\" class=\"btn btn-primary\" style=\" padding: 0px; \">c</button>")
	
	var blueprint = "do local blueprintData={"
	blueprint +=  add_icon([items[item_id].id])
	blueprint += "entities={"
	blueprint += add_assembler(ams[items[item_id].am_type].name, items[item_id].recipe, [0,0], 4)
	blueprint += add_entity("wooden-chest-passive", [-0,-3], 2, [(entity_number + 2)],[],[])
	blueprint += add_entity(inserter_type, [-0,-2], 4, [(entity_number)],["circuit", items[item_id].id, output, "<"],[])
	if (recipe.fluid.length > 0)
	{
		if (ams[items[item_id].am_type].name == "chemical-plant")
		{
			blueprint += add_assembler("replicator-5", items[recipe.fluid[0]].recipe, [0,3], 4)
			delete input_positions['4']
			delete input_positions['5']
		}
		else
		{
			blueprint += add_assembler("replicator-5", items[recipe.fluid[0]].recipe, [1,3], 4)
			delete input_positions['5']
			delete input_positions['6']
		}
	}
	else
	{
		delete input_positions['4']
		delete input_positions['6']	
	}
	var z=0;
	for(var k in input_positions)
	{
		{
			entity_number += 1
			blueprint += "[" + entity_number + "]={entity_number=" + entity_number + ",name=\"" + "wooden-chest-requester" + "\",position={x=" + input_positions[k].chest.x + ",y=" + input_positions[k].chest.y + "},direction=\"" + 2 + "\","
			blueprint += "request_filters={"
			for (var t in recipe.normal)
			{
				blueprint += "[" + (parseInt(t, 10) + parseInt(1, 10)) + "]={index=" + (parseInt(t, 10) + parseInt(1, 10)) + ",name=\"" + recipe.normal[t] + "\",count=" + 10 + "},"
			}
			blueprint += "}},"
		}
		blueprint += add_entity(inserter_type, [input_positions[k].inserter.x,input_positions[k].inserter.y], input_positions[k].inserter.vector, [],["logistics", recipe.normal[z], input, ">"],[])
		z++;
	}
	
	blueprint += "},"
	blueprint += add_name("ZZZ - " + items[item_id].name)
	blueprint += "};return blueprintData;end"
	//blueprint += recipe.normal.length
	$("#" + item_id).append(blueprint + "<br>")	
}

function make_blueprint(item_id)
{
	var output = 100;
	var input = 100;
	entity_number = -1;
	//var inserter_type = "smart-inserter"
	var input_positions = {
	"1": { inserter: { x:-2, y:-1, vector:6 }, chest: { x:-3 ,y:-1  } },
	"2": { inserter: { x:-2, y:0, vector:6 }, chest: { x:-3 ,y:0  } },
	"3": { inserter: { x:-2, y:1, vector:6 }, chest: { x:-3 ,y:1  } },
	
	"4": { inserter: { x:-1, y:2, vector:4 }, chest: { x:-1 ,y:3  } },
	"5": { inserter: { x:0, y:2, vector:4 }, chest: { x:0 ,y:3  } },
	"6": { inserter: { x:1, y:2, vector:4 }, chest: { x:1 ,y:3  } },
	
	"9": { inserter: { x:2, y:-1, vector:2 }, chest: { x:3 ,y:-1  } },
	"8": { inserter: { x:2, y:0, vector:2 }, chest: { x:3 ,y:0  } },
	"7": { inserter: { x:2, y:1, vector:2 }, chest: { x:3 ,y:1  } },
	}
	var name = items[item_id].id
	//alert(name)
	var recipe = calculate_recipe(item_id)
	//alert(recipe)
	$("#test").append("<textarea id=\"" + item_id + "\" style=\"width: 10px; height: 10px; display: none\"></textarea><button type=\"button\" id=\"" + item_id + "blueprintButton\" onclick=\"copyBlueprint('" + item_id + "')\" class=\"btn btn-primary\" style=\" padding: 0px; \">c</button>")
	
	var blueprint = "do local blueprintData={"
	blueprint +=  add_icon([items[item_id].id])
	blueprint += "entities={"
	blueprint += add_assembler(ams[items[item_id].am_type].name, items[item_id].recipe, [0,0], 4)
	blueprint += add_entity("wooden-chest-passive", [-1,-3], 2, [(entity_number + 2)],[],[])
	blueprint += add_entity(inserter_type, [-1,-2], 4, [(entity_number)],["circuit", items[item_id].id, output, "<"],[])
	blueprint += add_entity("wooden-chest-passive", [-0,-3], 2, [(entity_number + 2)],[],[])
	blueprint += add_entity(inserter_type, [-0,-2], 4, [(entity_number)],["circuit", items[item_id].id, output, "<"],[])
	blueprint += add_entity("wooden-chest-passive", [1,-3], 2, [(entity_number + 2)],[],[])
	blueprint += add_entity(inserter_type, [1,-2], 4, [(entity_number)],["circuit", items[item_id].id, output, "<"],[])
	if (recipe.fluid.length > 0)
	{
		if (ams[items[item_id].am_type].name == "chemical-plant-4")
		{
			blueprint += add_assembler("replicator-5", items[recipe.fluid[0]].recipe, [0,3], 4)
			delete input_positions['4']
			delete input_positions['5']
		}
		else
		{
			blueprint += add_assembler("replicator-5", items[recipe.fluid[0]].recipe, [1,3], 4)
			delete input_positions['5']
			delete input_positions['6']
		}
	}
	if (items[item_id].production > 17280)
	{
		blueprint += add_entity("wooden-chest-passive", [input_positions['1'].chest.x,input_positions['1'].chest.y], 2, [(entity_number + 2)],[],[])
		blueprint += add_entity(inserter_type, [input_positions['1'].inserter.x,input_positions['1'].inserter.y], 2, [(entity_number)],["circuit", items[item_id].id, output, "<"],[])
		blueprint += add_entity("wooden-chest-passive", [input_positions['9'].chest.x,input_positions['9'].chest.y], 2, [(entity_number + 2)],[],[])
		blueprint += add_entity(inserter_type, [input_positions['9'].inserter.x,input_positions['9'].inserter.y], 6, [(entity_number)],["circuit", items[item_id].id, output, "<"],[])
		delete input_positions['1']
		delete input_positions['9']
	}
	var z=0;
	for(var k in input_positions)
	{
		blueprint += add_entity("wooden-chest-requester", [input_positions[k].chest.x,input_positions[k].chest.y], 2, [],[],[recipe.normal[z], 50])
		blueprint += add_entity(inserter_type, [input_positions[k].inserter.x,input_positions[k].inserter.y], input_positions[k].inserter.vector, [],["logistics", recipe.normal[z], input, ">"],[])
		z++;
	}
	blueprint += add_entity("expansion-bay", [-2,-2], 2, [],[],[])
	blueprint += add_entity("expansion-bay", [-2,2], 2, [],[],[])
	blueprint += add_entity("expansion-bay", [2,-2], 2, [],[],[])
	blueprint += add_entity("expansion-bay", [2,2], 2, [],[],[])
	
	blueprint += "},"
	blueprint += add_name("ZZZ - " + items[item_id].name)
	blueprint += "};return blueprintData;end"
	//blueprint += recipe.normal.length
	$("#" + item_id).append(blueprint + "<br>")
}

function make_replicator_blueprint(item_id)
{
	var name = items[item_id].id
	$("#test").append("<textarea id=\"" + item_id + "\" style=\"width: 10px; height: 10px; display: none\"></textarea><button type=\"button\" id=\"" + item_id + "blueprintButton\" onclick=\"copyBlueprint('" + item_id + "')\" class=\"btn btn-primary\" style=\" padding: 0px; \">c</button>")
	var blueprint = "do local blueprintData={"
	blueprint +=  add_icon([items[item_id].id])
	blueprint += "entities={"
	
	blueprint += add_assembler("replicator-5", items[item_id].recipe, [-1,0], 4)
	blueprint += add_entity("wooden-chest-passive", [1,-1], 6, [(entity_number + 2)],[],[])
	blueprint += add_entity("smart-inserter", [0,-1], 6, [(entity_number)],["circuit", items[item_id].id, 100, "<"],[])
	blueprint += add_entity("wooden-chest-passive", [1,0], 6, [(entity_number + 2)],[],[])
	blueprint += add_entity("smart-inserter", [0,0], 6, [(entity_number)],["circuit", items[item_id].id, 100, "<"],[])
	for(var a=0; a < 4; a++)
	{
		blueprint += add_entity("expansion-bay", [-3+a,-2], 2, [],[],[])
		blueprint += add_entity("expansion-bay", [-3+a,1], 2, [],[],[])
	}
	
	
	blueprint += "},"
	blueprint += add_name("ZZZ - " + items[item_id].name)
	blueprint += "};return blueprintData;end"
	$("#" + item_id).append(blueprint + "<br>")
}


function copyBlueprint(text_id)
{
	var copyTextarea = document.getElementById(text_id);
	copyTextarea.style.display = "block";
    //var selectedValue = selectBox.options[selectBox.selectedIndex].value;
	//var copyTextarea = document.querySelector(text_id);
	copyTextarea.select();

	try 
	{
		var successful = document.execCommand('copy');
		var msg = successful ? 'successful' : 'unsuccessful';
		console.log('Copying text command was ' + msg);
	} 
	catch (err) 
	{
		console.log('Oops, unable to copy');
	}
	copyTextarea.style.display = "none";
	var button = document.getElementById(text_id + "blueprintButton");
	button.style.display = "none";
}

function removeItem(item_id)
{
	delete selectedList[item_id]
	table = [];
	for (var k in selectedList)
	{
		table.push(selectedList[k])
	}
	//table.push([selectBox.options[selectBox.selectedIndex].value, 100, false]);
	printSelected();
	//calc_total(table);
}

function printSelected()
{
	$("#selectedTable").html("")
	var text = "<div class=\"panel panel-primary\" style=\"margin-bottom: 0px; width: 1000px;\">";
	text += "<div class=\"panel-heading\">Selected Items</div><div class=\"panel-body\" style=\"display: inline-block;\">";
	for (var a = 0; a < table.length; a++)
	{
		text += items[table[a][0]].name + " -- "
		text += "<input value=\"" + selectedList[table[a][0]][1] + "\" type=\"text\" id=\"" + table[a][0] + "input\"></input>"
		//alert(parseInt($( "#"+(table[a][0]) + "input").val()))
		text += "<button type=\"button\" onclick=\"removeItem('" + table[a][0] + "')\" class=\"btn btn-primary\" style=\"float: middle; padding-bottom: 0px; padding-top: 0px; padding-right: 6px; padding-left: 6px\">-</button>" + "<br>"
	}
	//if (!typeof selectedList['advanced-circuit'] == undefined) {alert(selectedList['advanced-circuit'][0])}
	text += "</div></div>"
	$("#selectedTable").append(text)
}

function updateLevels()
{
	//if ($("#starter").is(":checked"))
	{
		if ($("#as1").is(":checked"))
		{
			ams['am6'].name = "assembling-machine-1"
			ams['am6'].speed = 0.5
		}
		if ($("#as2").is(":checked"))
		{
			ams['am6'].name = "assembling-machine-2"
			ams['am6'].speed = 0.75
		}
		if ($("#as3").is(":checked"))
		{
			ams['am6'].name = "assembling-machine-3"
			ams['am6'].speed = 1.25
		}
		if ($("#as4").is(":checked"))
		{
			ams['am6'].name = "assembling-machine-4"
			ams['am6'].speed = 2
		}
		if ($("#as5").is(":checked"))
		{
			ams['am6'].name = "assembling-machine-5"
			ams['am6'].speed = 2.75
		}
		if ($("#as6").is(":checked"))
		{
			ams['am6'].name = "assembling-machine-6"
			ams['am6'].speed = 3.5
		}
		
		if ($("#fur1").is(":checked"))
		{
			ams['electric_furnace'].name = "electric-furnace"
			ams['electric_furnace'].speed = 2
		}
		if ($("#fur2").is(":checked"))
		{
			ams['electric_furnace'].name = "electric-chemical-mixing-furnace-2"
			ams['electric_furnace'].speed = 4
		}
		
		if ($("#chem1").is(":checked"))
		{
			ams['chemical_plant'].name = "chemical-plant"
			ams['chemical_plant'].speed = 1.25
		}
		if ($("#chem2").is(":checked"))
		{
			ams['chemical_plant'].name = "chemical-plant-2"
			ams['chemical_plant'].speed = 2
		}
		if ($("#chem3").is(":checked"))
		{
			ams['chemical_plant'].name = "chemical-plant-3"
			ams['chemical_plant'].speed = 2.75
		}
		if ($("#chem4").is(":checked"))
		{
			ams['chemical_plant'].name = "chemical-plant-4"
			ams['chemical_plant'].speed = 3.5
		}
		
		if ($("#basicinserter").is(":checked"))
		{
			inserter_type = "basic-inserter"
		}
		if ($("#fastinserter").is(":checked"))
		{
			inserter_type = "fast-inserter"
		}
		if ($("#smartinserter").is(":checked"))
		{
			inserter_type = "smart-inserter"
		}
		ams['am6'].productivity = 1 + (parseInt($( "#asmprod" ).val())/100)
		ams['am6'].speed = ams['am6'].speed * (1 + (parseInt($( "#asmspeed" ).val())/100))
		
		ams['chemical_plant'].productivity = 1 + (parseInt($( "#chemprod" ).val())/100)
		ams['chemical_plant'].speed = ams['chemical_plant'].speed * (1 + (parseInt($( "#chemspeed" ).val())/100))

		ams['electric_furnace'].productivity = 1 + (parseInt($( "#furprod" ).val())/100)
		ams['electric_furnace'].speed = ams['electric_furnace'].speed * (1 + (parseInt($( "#furspeed" ).val())/100))
	}
	
	
	for (var k in selectedList)
	{	
		selectedList[k][1] = parseInt($( "#"+(k) + "input").val())
		//alert(selectedList[k][1])
	}
	//alert($("#starter").is(":checked"))
	changeFunc();
	calc_total(table);

	//if ($("#starter").is(":checked"))
	{	
		ams['am6'].name = "assembling-machine-6"
		ams['am6'].productivity = 3.4
		ams['am6'].speed = 3.5 * (1+19.2)
		ams['chemical_plant'].name = "chemical-plant-4"
		ams['chemical_plant'].productivity = 3.4
		ams['chemical_plant'].speed = 3.5 * (1+19.2)
		ams['electric_furnace'].name = "electric-chemical-mixing-furnace-2"
		ams['electric_furnace'].productivity = 3.4
		ams['electric_furnace'].speed = 4 * (1+19.2)
	}
	//alert(Object.keys(items).length)
}

var tick = 1/60
var table = [];
var selectedList = {};

populateSelect()
printSelected();
//calc_total([['am-mk6',1000,false]]);
//make_blueprint('battery')
</script></body></html>